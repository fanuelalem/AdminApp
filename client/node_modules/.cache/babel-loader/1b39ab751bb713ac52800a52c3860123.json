{"ast":null,"code":"const {\n  isEmail,\n  isLength\n} = require('validator');\n\nconst jwt = require('jwt-simple');\n\nconst axios = require('axios');\n\nconst {\n  User\n} = require('../models');\n\nconst {\n  secret,\n  GITHUB_CLIENT_SECRET\n} = require('../config');\n\nfunction tokenForUser(user) {\n  const timeStamp = new Date().getTime();\n  return jwt.encode({\n    sub: user._id,\n    iat: timeStamp\n  }, process.env.SECRET || secret);\n}\n\nmodule.exports = {\n  signUp: async (req, res) => {\n    const {\n      email,\n      password\n    } = req.body;\n\n    if (!email || !password) {\n      return res.status(422).json({\n        error: 'You must provide email and password'\n      });\n    }\n\n    if (!isEmail(email)) {\n      return res.status(403).json({\n        error: 'You must provide a valid email address'\n      });\n    }\n\n    if (!isLength(password, {\n      min: 6\n    })) {\n      return res.status(403).json({\n        error: 'Your password must be at least 6 characters long'\n      });\n    }\n\n    try {\n      // See if a user with the given email exists\n      const existingUser = await User.findOne({\n        email\n      });\n\n      if (existingUser) {\n        return res.status(403).json({\n          error: 'User already exists'\n        });\n      }\n\n      const user = await new User({\n        email,\n        password\n      }).save();\n      console.log(user, 'dadad');\n      const currentUser = await User.findById(user._id).select('-password'); // Eventually we will send a token\n\n      return res.json({\n        token: tokenForUser(user),\n        user: currentUser\n      });\n    } catch (e) {\n      return res.status(403).json({\n        e\n      });\n    }\n  },\n  signIn: async (req, res) => {\n    const currentUser = await User.findOne({\n      email: req.user.email\n    }).select('-password');\n    res.json({\n      token: tokenForUser(req.user),\n      user: currentUser\n    });\n  }\n};","map":null,"metadata":{},"sourceType":"script"}